<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">
    <title>SecurePasswords.info | Password Validator for PHP</title>
    <link href="/components/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="/components/font-awesome/css/font-awesome.min.css" rel="stylesheet">
    <link href="/themes/dshafik/securepasswords.info/assets/css/site.css" rel="stylesheet">
	<link href='http://fonts.googleapis.com/css?family=Lobster' rel='stylesheet' type='text/css'>     
    <link rel="stylesheet" href="/components/highlightjs/styles/github.css" />
    <link rel="shortcut icon" href="/themes/dshafik/securepasswords.info/assets/images/ico/favicon.ico">
</head><!--/head-->
<body>
    <header id="header">
		        <nav class="navbar navbar-inverse" style="background-color: #ec6b4c;" role="banner">
		            <div class="container">
                <h1 class="navbar-header">
					                    <a class="navbar-brand" style="color: #fff !important;" href="/">SecurePasswords.info</a>
					                </h1>
                <ul class="social-share pull-right">
                    <li><a href="https://twitter.com/securepasswrds"><i class="fa fa-twitter"></i></a></li>
					<li><a href="https://github.com/dshafik/securepasswords.info"><i class="fa fa-github-alt"></i></a></li>
                </ul>
            </div><!--/.container-->
        </nav><!--/nav-->
    </header><!--/header-->

    <section>
        <div class="container">
            <div class="row">
				    <article class="col-xs-10 col-sm-push-2">
        <header>
            <h1>Password Validator for PHP</h1>
        </header>
        <div>
            <p><strong>Password Validator</strong> <em>validates</em> <a href="http://www.php.net/manual/en/function.password-hash.php"><code>password_hash</code></a> generated passwords, <em>rehashes</em>
passwords as necessary, and will <em>upgrade</em> legacy passwords.</p>

<p><em>Password Validator is available for all versions of PHP >= 5.3.7.</em></p>

<h2>Installation</h2>

<p>The only officially supported method of installation is via
<a href="http://getcomposer.org">Composer</a>.</p>

<p>Create a <code>composer.json</code> file in the root of your project (<a href="https://packagist.org/packages/jeremykendall/password-validator">always check
Packagist</a> for the most recent version):</p>

<pre><code class="json">{
    "require": {
        "jeremykendall/password-validator": "*"
    }
}
</code></pre>

<p>And then run: <code>composer install</code></p>

<p>Add the autoloader to your project:</p>

<pre><code class="php">&lt;?php

require_once '../vendor/autoload.php'
</code></pre>

<p>You're now ready to begin using the Password Validator.</p>

<h2>Usage</h2>

<h3>Password Validation</h3>

<p>If you're already using <a href="http://www.php.net/manual/en/function.password-hash.php"><code>password_hash</code></a> generated passwords in your
application, you need do nothing more than add the validator in your
authentication script. The validator uses <a href="http://www.php.net/manual/en/function.password-verify.php"><code>password_verify</code></a> to test
the validity of the provided password hash.</p>

<pre><code class="php">use JeremyKendall\Password\PasswordValidator;

$validator = new PasswordValidator();
$result = $validator-&gt;isValid($_POST['password'], $hashedPassword);

if ($result-&gt;isValid()) {
    // password is valid
}
</code></pre>

<p>If your application requires options other than the <code>password_hash</code> defaults,
you can set both the <code>salt</code> and <code>cost</code> options with <code>PasswordValidator::setOptions()</code>.</p>

<pre><code class="php">$options = array(
    'salt' =&gt; 'SettingYourOwnSaltIsNotTheBestIdea',
    'cost' =&gt; 11,
);
$validator-&gt;setOptions($options);
</code></pre>

<p><strong>IMPORTANT</strong>: <code>PasswordValidator</code> uses a default cost of <code>10</code>. If your
existing hash implementation requires a different cost, make sure to specify it
using <code>PasswordValidator::setOptions()</code>. If you do not do so, all of your
passwords will be rehashed using a cost of <code>10</code>.</p>

<h3>Rehashing</h3>

<p>Each valid password is tested using <a href="http://www.php.net/manual/en/function.password-needs-rehash.php"><code>password_needs_rehash</code></a>. If a rehash
is necessary, the valid password is hashed using <code>password_hash</code> with the
provided options. The result code <code>Result::SUCCESS_PASSWORD_REHASHED</code> will be
returned from <code>Result::getCode()</code> and the new password hash is available via
<code>Result::getPassword()</code>.</p>

<pre><code class="php">if ($result-&gt;getCode() === Result::SUCCESS_PASSWORD_REHASHED) {
    $rehashedPassword = $result-&gt;getPassword();
    // Persist rehashed password
}
</code></pre>

<p><strong>IMPORTANT</strong>: If the password has been rehashed, it's critical that you
persist the updated password hash. Otherwise, what's the point, right?</p>

<h3>Upgrading Legacy Passwords</h3>

<p>You can use the <code>PasswordValidator</code> whether or not you're currently using
<code>password_hash</code> generated passwords. The validator will transparently upgrade
your current legacy hashes to the new <code>password_hash</code> generated hashes as each
user logs in.  All you need to do is provide a validator callback for your
password hash and then <a href="http://en.wikipedia.org/wiki/Decorator_pattern">decorate</a> the validator with the <code>UpgradeDecorator</code>.</p>

<pre><code class="php">use JeremyKendall\Password\Decorator\UpgradeDecorator;

// Example callback to validate a sha512 hashed password
$callback = function ($password, $passwordHash, $salt) {
    if (hash('sha512', $password . $salt) === $passwordHash) {
        return true;
    }

    return false;
};

$validator = new UpgradeDecorator(new PasswordValidator(), $callback);
$result = $validator-&gt;isValid('password', 'password-hash', 'legacy-salt');
</code></pre>

<p>The <code>UpgradeDecorator</code> will validate a user's current password using the
provided callback.  If the user's password is valid, it will be hashed with
<code>password_hash</code> and returned in the <code>Result</code> object, as above.</p>

<p>All password validation attempts will eventually pass through the
<code>PasswordValidator</code>. This allows a password that has already been upgraded to
be properly validated, even when using the <code>UpgradeDecorator</code>.</p>

<h3>Persisting Rehashed Passwords</h3>

<p>Whenever a validation attempt returns <code>Result::SUCCESS_PASSWORD_REHASHED</code>, it's
important to persist the updated password hash.</p>

<pre><code class="php">if ($result-&gt;getCode() === Result::SUCCESS_PASSWORD_REHASHED) {
    $rehashedPassword = $result-&gt;getPassword();
    // Persist rehashed password
}
</code></pre>

<p>While you can always perform the test and then update your user database
manually, if you choose to use the <strong>Storage Decorator</strong> all rehashed passwords
will be automatically persisted.</p>

<p>The Storage Decorator takes two constructor arguments: An instance of
<code>PasswordValidatorInterface</code> and an instance of the
<code>JeremyKendall\Password\Storage\StorageInterface</code>.</p>

<h4>StorageInterface</h4>

<p>The <code>StorageInterface</code> includes a single method, <code>updatePassword()</code>. A class
honoring the interface might look like this:</p>

<pre><code class="php">&lt;?php

namespace Example;

use JeremyKendall\Password\Storage\StorageInterface;

class UserDao implements StorageInterface
{
    public function __construct(\PDO $db)
    {
        $this-&gt;db = $db;
    }

    public function updatePassword($identity, $password)
    {
        $sql = 'UPDATE users SET password = :password WHERE username = :identity';
        $stmt = $this-&gt;db-&gt;prepare($sql);
        $stmt-&gt;execute(array('password' =&gt; $password, 'username' =&gt; $identity));
    }
}
</code></pre>

<h4>Storage Decorator</h4>

<p>With your <code>UserDao</code> in hand, you're ready to decorate a
<code>PasswordValidatorInterface</code>.</p>

<pre><code class="php">use Example\UserDao;
use JeremyKendall\Password\Decorator\StorageDecorator;

$storage = new UserDao($db);
$validator = new StorageDecorator(new PasswordValidator(), $storage);

// If validation results in a rehash, the new password hash will be persisted
$result = $validator-&gt;isValid('password', 'passwordHash', null, 'username');
</code></pre>

<p><strong>IMPORTANT</strong>: You must pass the optional fourth argument (<code>$identity</code>) to
<code>isValid()</code> when calling <code>StorageDecorator::isValid()</code>.  If you do not do so,
the <code>StorageDecorator</code> will throw an <code>IdentityMissingException</code>.</p>

<h3>Validation Results</h3>

<p>Each validation attempt returns a <code>JeremyKendall\Password\Result</code> object. The
object provides some introspection into the status of the validation process.</p>

<ul>
<li><code>Result::isValid()</code> will return <code>true</code> if the attempt was successful</li>
<li><code>Result::getCode()</code> will return one of three possible <code>int</code> codes:

<ul>
<li><code>Result::SUCCESS</code> if the validation attempt was successful</li>
<li><code>Result::SUCCESS_PASSWORD_REHASHED</code> if the attempt was successful and the password was rehashed</li>
<li><code>Result::FAILURE_PASSWORD_INVALID</code> if the attempt was unsuccessful</li>
</ul></li>
<li><code>Result::getPassword()</code> will return the rehashed password, but only if the password was rehashed</li>
</ul>

<h3>Database Schema Changes</h3>

<p>As mentioned above, because this library uses the <code>PASSWORD_DEFAULT</code> algorithm,
it's important your password field be <code>VARCHAR(255)</code> to account for future
updates to the default password hashing algorithm.</p>

<h2>cost-check Helper Script</h2>

<p>The default <code>cost</code> used by <code>password_hash</code> is 10.  This may or may not be
appropriate for your production hardware, and it's entirely likely you can use
a higher cost than the default. <code>cost-check</code> is based on the <a href="http://php.net/password_hash#example-875">finding a good
cost</a> example in the PHP documentation. Simply run <code>./vendor/bin/cost-check</code> from the command line and an appropriate cost will be returned.</p>

<p><strong>NOTE</strong>: The default time target is 0.2 seconds.  You may choose a higher or lower
target by passing a float argument to <code>cost-check</code>, like so:</p>

<pre><code class="bash">$ ./vendor/bin/cost-check 0.4
Appropriate 'PASSWORD_DEFAULT' Cost Found:  13
</code></pre>

        </div>
    </article>
    <div class="byline col-sm-pull-10 col-xs-2">
        <div class="author text-center">
            <h4>Jeremy Kendall</h4>
                        <a class="author-url" href="http://about.me/jeremykendall">
                <img src="https://secure.gravatar.com/avatar/f8ee60f3cb8ecc91f41ee093542e12f4" alt="Jeremy Kendall">
            </a>
                                        <a class="author-twitter" href="https://twitter.com/JeremyKendall">
                    <i class="fa fa-twitter"></i> @JeremyKendall
                </a>
                    </div>
                    <div class="sponsor text-center">
                <h5>Sponsored By</h5>
                <a class="sponsor-url" href="http://graphstory.com/" title="Graph Story">
                                            <img src="http://graphstory.com/img/logo.png">
                                    </a>
                                    <a class="sponsor-twitter" href="https://twitter.com/GraphStoryCo">
                        <i class="fa fa-twitter"></i> @GraphStoryCo
                    </a>
                            </div>
            </div>
            </div>
        </div>
    </section>

    <footer id="footer">
        <div class="container">
            <div class="row">
                <div class="col-sm-7 col-xs-12">
                    <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/4.0/80x15.png" /></a><br /><span xmlns:dct="http://purl.org/dc/terms/" href="http://purl.org/dc/dcmitype/Text" property="dct:title" rel="dct:type">SecurePasswords.info</span> is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>. Based on a work at <a xmlns:dct="http://purl.org/dc/terms/" href="https://github.com/dshafik/securepasswords.info" rel="dct:source">https://github.com/dshafik/securepasswords.info</a>.
                </div>
                <div class="col-sm-3 col-sm-push-2 col-xs-12 text-center">
					<div class="row">
						<ul>
                        	<li><a class="btn btn-default" href="/">Home</a></li>
							<li><a class="btn btn-default" href="/about">About</a></li>
							<li><a class="btn btn-default" href="https://github.com/dshafik/securepasswords.info">Contribute</a></li>
						</ul>
					</div>
					<div class="row">
						<p class="text-center" style="margin-top: 1em;">
							Sponsored By
							<br>
							<a href="https://www.engineyard.com"><img src="/themes/dshafik/securepasswords.info/assets/images/engineyard.png" width="150"></a>
						</p>
					</div>
                </div>
            </div>
        </div>
    </footer><!--/#footer-->

    <script src="/components/jquery/jquery-built.js"></script>
    <script src="/components/bootstrap/js/bootstrap.min.js"></script>
	<script src="/components/highlightjs/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
	<script>
	  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	  ga('create', 'UA-743285-5', 'auto');
	  ga('send', 'pageview');
	</script>
</body>
</html>
